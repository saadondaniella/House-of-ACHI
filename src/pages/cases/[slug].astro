---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { cases } from "../../data/cases.js";

export function getStaticPaths() {
  return cases.map((c) => ({
    params: { slug: c.slug },
    props: { caseItem: c },
  }));
}

const { caseItem } = Astro.props;
const gallery = caseItem.gallery || [];

const fullWidthSrc =
  caseItem.fullWidthImage ||
  (gallery.filter((g) => g.type === "image").length
    ? gallery.filter((g) => g.type === "image").slice(-1)[0].src
    : null);
---

<BaseLayout title={`${caseItem.title} — House of Achi`}>
  <main class="case-page">
    <main id="top" class="case">
      <header class="case-hero">
        <div class="case-hero-inner">
          <a href="/#cases" class="case-back">← Back to cases</a>

          <div class="case-hero-title">
            <h1>{caseItem.title}</h1>

            <div class="case-meta">
              {caseItem.client && <span>{caseItem.client}</span>}
              {caseItem.year && <span>{caseItem.year}</span>}
            </div>
          </div>

          <div class="case-hero-row">
            <div class="case-hero-media">
              {
                caseItem.heroMedia.type === "image" ? (
                  <img
                    src={caseItem.heroMedia.src}
                    alt={caseItem.heroMedia.alt ?? ""}
                    loading="eager"
                  />
                ) : (
                  <video
                    src={caseItem.heroMedia.src}
                    autoplay
                    muted
                    loop
                    playsinline
                    preload="metadata"
                  />
                )
              }
            </div>

            {
              caseItem.heroText && (
                <aside class="case-hero-text">
                  <h3>{caseItem.heroText.title}</h3>
                  {caseItem.heroText.paragraphs?.map((p) => (
                    <p>{p}</p>
                  ))}
                </aside>
              )
            }
          </div>
        </div>
      </header>

      {
        caseItem.introVideo && (
          <section class="case-intro-video">
            <div class="case-intro-video-inner">
              <video
                src={caseItem.introVideo.src}
                poster={caseItem.introVideo.poster}
                autoplay
                muted
                loop
                playsinline
                preload="metadata"
              />
            </div>
          </section>
        )
      }

      {
        caseItem.description?.length ? (
          <section class="case-text">
            <div class="case-text-inner">
              {caseItem.description.map((p) => (
                <p>{p}</p>
              ))}
            </div>
          </section>
        ) : null
      }

      <section class="case-gallery" aria-label="Case gallery">
        <div class="case-gallery-inner">
          {
            gallery.map((item) =>
              item.type === "image" ? (
                <figure class="case-tile">
                  <img src={item.src} alt={item.alt ?? ""} loading="lazy" />
                </figure>
              ) : item.type === "video" ? (
                <figure class="case-tile">
                  <video
                    src={item.src}
                    poster={item.poster}
                    autoplay
                    muted
                    loop
                    playsinline
                    preload="metadata"
                  />
                </figure>
              ) : item.type === "text" ? (
                <figure class="case-tile case-text-tile">
                  <div class="case-text-card">
                    <h3>{item.title}</h3>
                    {item.paragraphs?.map((p) => (
                      <p>{p}</p>
                    ))}
                  </div>
                </figure>
              ) : null,
            )
          }
        </div>
      </section>
      {
        fullWidthSrc && (
          <section class="case-fullbleed" aria-hidden="false">
            <div class="case-fullbleed-inner">
              <img
                src={fullWidthSrc}
                alt={caseItem.title ?? ""}
                loading="lazy"
              />
            </div>
          </section>
        )
      }

      <section class="case-back-top">
        <a href="#top">↑ Back to top</a>
      </section>
    </main>
  </main>

</BaseLayout>
